-- 불량 정보 관리 테이블 생성
create table DEFECT_INFO_TBL (
    DEFECT_CODE VARCHAR(4) primary key NOT NULL, -- 4글자(불량코드)
    DEFECT_NAME VARCHAR(150) NOT NULL, -- 불량명(중복가능?)
    DEFECT_ABR VARCHAR(10), -- 4~5자(불량명약자)
    DEFECT_RMRKS VARCHAR(150), -- 불량 비고
    DEFECT_MODIFY_D VARCHAR(15) NOT NULL, -- 수정일자
    DEFECT_MODIFIER VARCHAR(30) NOT NULL, -- 10글자(수정자)
    DEFECT_USE_STATUS varchar(5) NOT NULL check (DEFECT_USE_STATUS in('true','false')) -- 사용여부 
);

-- 사용자 관리 테이블
create table USER_INFO_TBL (
    USER_CODE VARCHAR(20) UNIQUE NOT null PRIMARY KEY, -- 사용자 코드(공통 테이블 코드 참조)
    USER_PASSWORD VARCHAR(50) NOT NULL, -- 사용자 비밀번호
    USER_NAME VARCHAR(20) NOT NULL, -- 사용자명
    USER_TYPE varchar(10) NOT NULL, -- 사용자 타입(1:관리자, 2:현장입력자, 3:마스터,  4:테스트)
    COMPANY varchar(10) NOT NULL, -- 사업장(1:본사, 2:1공장, 3:2공장)
    DEPT_CODE varchar(10) NOT NULL , -- 부서코드(공통 테이블 부서코드 참조, 부서명)
    USER_MODIFIER VARCHAR(20) NOT NULL,-- 수정자
    USER_MODIFY_D VARCHAR(15) NOT NULL, -- 수정일자
    USER_USE_STATUS varchar(5) NOT NULL check (USER_USE_STATUS in('true','false')), -- 사용유무
    FOREIGN KEY (USER_TYPE) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (DEPT_CODE) REFERENCES DTL_TBL(CHILD_TBL_NUM)
);

-- 공통 테이블
create table CMN_TBL (
    NEW_TBL_CODE int not null auto_increment primary key, -- 테이블 코드
    NEW_TBL_NAME VARCHAR(20) UNIQUE NOT NULL, -- 테이블 명
    NEW_TBL_RMARK VARCHAR(150) -- 설명
);

-- 세부 테이블
create table DTL_TBL (
    NEW_TBL_CODE int not null, -- 테이블 코드(공통 코드 참조)
    CHILD_TBL_NUM varchar(10) NOT null, -- 자식 순번
    CHILD_TBL_TYPE varchar(100) not null, -- 자료값
    CHILD_TBL_RMARK varchar(150), -- 설명
    CHILD_TBL_USE_STATUS varchar(5) not null check (CHILD_TBL_USE_STATUS in('true','false')), -- 사용유무
    FOREIGN KEY (NEW_TBL_CODE) REFERENCES CMN_TBL(NEW_TBL_CODE),
    CONSTRAINT DTL_TBL_PK PRIMARY KEY(NEW_TBL_CODE,CHILD_TBL_NUM)
);






-- 금형 정보 관리 테이블
create table MOLD_INFO_TBL (
   -- 금형 A : 차수(1차, 2차...) : 품목코드 1
   -- 금형 B : 차수(1차, 2차 ...)  : 폼목코드 1
    BUSINESS_PLACE varchar(10) not null, -- 사업장 (세부 테이블)
    MOLD_INFO_NO varchar(10) primary key not null, -- 금형관리 no(기본키)
    MOLD_INFO_NAME varchar(100), -- 금형명
    MOLD_INFO_RANK varchar(10) not null, -- 차수(세부 테이블의 공통 코드)
    MOLD_INFO_STND varchar(150), -- 규격
    MOLD_ITEM_CODE varchar(10) not null, -- 품목코드(제품정보관리의 품목코드)
    MANUFACTURER varchar(100), -- 제작업체
    BUSINESS_PERSON varchar(20), -- 업체담당자
    MOLD_RECEIVED_D varchar(15), -- 입고일
    USER_MODIFIER varchar(20) not null,-- 수정자
    USER_MODIFY_D varchar(15) not null, -- 수정일자
    MOLD_USE_STATUS varchar(5) not null check (MOLD_USE_STATUS in('true','false')), -- 사용유무
    FOREIGN KEY (MOLD_INFO_RANK) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (MOLD_ITEM_CODE) REFERENCES 
               PRODUCT_INFO_TBL(PRODUCT_ITEM_CODE)
);

-- 제품 정보 관리 테이블
create table PRODUCT_INFO_TBL (
   PRODUCT_BUSINESS_PLACE varchar(10) not null, -- 사업장 (세부 테이블)
    PRODUCT_ITEM_CODE varchar(20) not null, -- 품목코드 (기본키)
    PRODUCT_OLD_ITEM_CODE varchar(20), -- 구품목코드
    PRODUCT_ITEM_NAME varchar(100) not null, -- 품명
    PRODUCT_INFO_STND_1 varchar(150), -- 규격1
    PRODUCT_INFO_STND_2 varchar(150), -- 규격2
    PRODUCT_UNIT varchar(10) not null, -- 단위 (세부코드)
    PRODUCT_MATERIAL varchar(10) not null, --  재질 (세부코드)
    PRODUCT_MTRL_CLSFC varchar(10) not null, -- 자재분류 (세부코드)
    PRODUCT_ITEM_CLSFC_1 varchar(10) not null, -- 품목분류1 (세부코드)
    PRODUCT_ITEM_CLSFC_2 varchar(10) not null, -- 품목분류2 (세부코드)
    PRODUCT_SUBSID_MATL_MGMT varchar(5) not null check (PRODUCT_SUBSID_MATL_MGMT in('true','false')), -- 부자재관리
    PRODUCT_ITEM_STTS varchar(10) not null,-- 품목상태 (세부코드)
    PRODUCT_BASIC_WAREHOUSE varchar(10) not null, -- 기본창고  (세부코드)
    PRODUCT_SFTY_STOCK int, --  안전재고
    PRODUCT_MIN_VOL_ORDERS float,  --  최소발주량 
    PRODUCT_MAX_VOL_ORDERS float, --  최대발주량 
    PRODUCT_BUYER varchar(20), -- 구매담당자
    PRODUCT_WRHSN_INSPC varchar(5) not null check (PRODUCT_WRHSN_INSPC in('true','false')), -- 입고검사
    PRODUCT_USE_STATUS varchar(5) not null check (PRODUCT_USE_STATUS in('true','false')), -- 사용유무
   PRODUCT_MODIFY_D varchar(15) not null, -- 수정일자
    PRODUCT_MODIFIER varchar(20) not null,-- 수정자
    FOREIGN KEY (PRODUCT_UNIT) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_MATERIAL) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_MTRL_CLSFC) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_ITEM_CLSFC_1) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_ITEM_CLSFC_2) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_ITEM_STTS) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    FOREIGN KEY (PRODUCT_BASIC_WAREHOUSE) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    CONSTRAINT PRODUCT_INFO_TBL_PK PRIMARY KEY(PRODUCT_ITEM_CODE)
);

-- 설비 정보 관리 테이블
create table EQUIPMENT_INFO_TBL (
   EQUIPMENT_BUSINESS_PLACE varchar(10) not null, -- 사업장 (세부 테이블)
   EQUIPMENT_INFO_CODE varchar(20) not null, -- 설비코드 (기본키)
   EQUIPMENT_INFO_NAME varchar(100), --  설비명
    EQUIPMENT_INFO_ABR varchar(20), -- 설비호기
    EQUIPMENT_HEIGHT float, -- 설비(높이)
    EQUIPMENT_WIDTH float, -- 설비(폭)
    EQUIPMENT_DEPTH float, -- 설비(깊이)
    EQUIPMENT_SERIAL_NUM varchar(50), -- 설비(시리얼 넘버)
    EQUIPMENT_WEIGHT float, -- 설비(무게)
    EQUIPMENT_RECEIVED_D varchar(15), -- 설비 구입일자
    EQUIPMENT_MODEL_YEAR varchar(10), -- 설비 연식
    EQUIPMENT_MANUFACTURER varchar(100), -- 제작업체
    EQUIPMENT_STATUS varchar(10) not null, -- 설비상태(세부코드)
    EQUIPMENT_INFO_RMARK varchar(150), -- 비고
    EQUIPMENT_USE_STATUS varchar(5) not null check (EQUIPMENT_USE_STATUS in('true','false')), -- 사용유무
    EQUIPMENT_MODIFY_D varchar(15) not null,-- 수정일자
    EQUIPMENT_MODIFIER varchar(20) not null,-- 수정자
    EQUIPMENT_FilePath varchar(300),  -- 사진 업로드
    FOREIGN KEY (EQUIPMENT_STATUS) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    CONSTRAINT EQUIPMENT_INFO_TBL_PK PRIMARY KEY(EQUIPMENT_INFO_CODE)
);

-- 생산 정보 관리 테이블
create table PRODUCTION_MGMT_TBL (
   PRODUCTION_SERIAL_NUM varchar(30) not null, -- 시리얼 넘버(형식 : 년(2)월(2)일(2)시(2)분(2) : 2012312400+ 설비호기)
   PRODUCTION_INFO_NUM int not null,  -- 순번
    PRODUCTION_EQUIPMENT_CODE varchar(20) not null, -- 설비코드(설비 정보 테이블)
    PRODUCTION_MOLD_INFO_CODE varchar(10) not null, -- 금형No(금형 정보 테이블)
    PRODUCTION_PRODUCT_CODE varchar(20) not null, -- 제품No(제품 정보 테이블)
    PRODUCTION_DEFECT_CODE varchar(4) not null, -- 불량정보No(불량 정보 테이블)
    PRODUCTION_VOLUME int, -- 생산수량
    PRODUCTION_BAD int, -- 불량수량(생산량)
    PRODUCTION_MODIFY_D datetime default current_timestamp, -- 날짜(닐찌,시간,분,초) 
    PRODUCTION_CC varchar(1) NOT NULL, -- 구분
    PRODUCTION_USER_CODE varchar(20) NOT NULL, -- 사용자ID
    FOREIGN KEY (PRODUCTION_EQUIPMENT_CODE) REFERENCES 
               EQUIPMENT_INFO_TBL(EQUIPMENT_INFO_CODE),
    FOREIGN KEY (PRODUCTION_MOLD_INFO_CODE) REFERENCES MOLD_INFO_TBL(MOLD_INFO_NO),
    FOREIGN KEY (PRODUCTION_PRODUCT_CODE) REFERENCES 
               PRODUCT_INFO_TBL(PRODUCT_ITEM_CODE),
    FOREIGN KEY (PRODUCTION_DEFECT_CODE) REFERENCES DEFECT_INFO_TBL(DEFECT_CODE),
   CONSTRAINT PRODUCTION_MGMT_TBL_PK PRIMARY KEY(PRODUCTION_SERIAL_NUM, PRODUCTION_INFO_NUM)
);

-- 권한 관리 테이블
create table RIGHTS_MGMT_TBL (
    RIGHTS_USER_TYPE varchar(10) not null, -- 사용자관리테이블
    RIGHTS_PROGRAM_CODE varchar(10) not null, -- 세부테이블(프로그램코드)
    RIGHTS_MGMT_USE_STATUS varchar(5) not null check (RIGHTS_MGMT_USE_STATUS in('true','false')),
    FOREIGN KEY (RIGHTS_USER_TYPE) REFERENCES USER_INFO_TBL(USER_TYPE),
    FOREIGN KEY (RIGHTS_PROGRAM_CODE) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    CONSTRAINT RIGHTS_MGMT_TBL_PK PRIMARY KEY(RIGHTS_USER_TYPE,RIGHTS_PROGRAM_CODE)
);

-- 메뉴 관리 테이블
create table MENU_MGMT_TBL (
    MENU_USER_CODE varchar(20) not null, -- 사용자관리테이블
    MENU_PROGRAM_CODE varchar(10) not null, -- 세부테이블(프로그램코드)
    MENU_READ_USE_STATUS varchar(5) not null check (READ_USE_STATUS in('true','false')),
    MENU_WRITE_USE_STATUS varchar(5) not null check (WRITE_USE_STATUS in('true','false')),
    MENU_DEL_USE_STATUS varchar(5) not null check (DEL_USE_STATUS in('true','false')),
    MENU_MGMT_USE_STATUS varchar(5) not null check (MENU_MGMT_USE_STATUS in('true','false')),
    FOREIGN KEY (MENU_USER_CODE) REFERENCES USER_INFO_TBL(USER_TYPE),
    FOREIGN KEY (MENU_PROGRAM_CODE) REFERENCES DTL_TBL(CHILD_TBL_NUM),
    CONSTRAINT MENU_MGMT_TBL_PK PRIMARY KEY(MENU_USER_CODE,MENU_PROGRAM_CODE)
);
















